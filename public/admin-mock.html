<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIC Global - Admin Panel (Mock)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stat-number { font-size: 2em; font-weight: bold; color: #2563eb; }
        .stat-label { color: #666; margin-top: 5px; }
        .transactions { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .transactions-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .transaction-item { padding: 15px 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .transaction-info { flex: 1; }
        .transaction-type { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; text-transform: uppercase; }
        .type-deposit { background: #dcfce7; color: #166534; }
        .type-withdrawal { background: #fef3c7; color: #92400e; }
        .transaction-amount { font-weight: bold; margin: 5px 0; }
        .transaction-user { color: #666; font-size: 14px; }
        .transaction-date { color: #999; font-size: 12px; }
        .actions { display: flex; gap: 10px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; }
        .btn-approve { background: #10b981; color: white; }
        .btn-reject { background: #ef4444; color: white; }
        .btn:hover { opacity: 0.8; }
        .refresh-btn { background: #2563eb; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .loading { opacity: 0.6; pointer-events: none; }
        .message { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .login-form { max-width: 400px; margin: 100px auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .login-btn { width: 100%; background: #2563eb; color: white; padding: 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .hidden { display: none; }
        .mock-notice { background: #fef3c7; color: #92400e; padding: 10px; border-radius: 4px; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm" class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px;">Admin Login (Mock)</h2>
        <div class="form-group">
            <label>Admin Password:</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password">
        </div>
        <button class="login-btn" onclick="login()">Login</button>
        <div id="loginMessage"></div>
    </div>

    <!-- Admin Dashboard -->
    <div id="dashboard" class="container hidden">
        <div class="mock-notice">
            ðŸ§ª <strong>Mock Mode:</strong> This is using test data. Set up Supabase environment variables to use real data.
        </div>
        
        <div class="header">
            <h1>TIC Global - Admin Panel (Mock)</h1>
            <p>Manage deposits and withdrawals</p>
            <button class="refresh-btn" onclick="refreshData()">Refresh Data</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalPending">0</div>
                <div class="stat-label">Total Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingDeposits">0</div>
                <div class="stat-label">Pending Deposits</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="pendingWithdrawals">0</div>
                <div class="stat-label">Pending Withdrawals</div>
            </div>
        </div>

        <div class="transactions">
            <div class="transactions-header">
                <h3>Pending Transactions</h3>
                <span id="lastUpdated">Never updated</span>
            </div>
            <div id="transactionsList">
                <div style="padding: 40px; text-align: center; color: #666;">
                    Loading transactions...
                </div>
            </div>
        </div>

        <div id="messages"></div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin123';
        let isLoggedIn = false;

        function login() {
            const password = document.getElementById('adminPassword').value;
            const messageDiv = document.getElementById('loginMessage');
            
            if (password === ADMIN_PASSWORD) {
                isLoggedIn = true;
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                refreshData();
            } else {
                messageDiv.innerHTML = '<div class="error">Invalid password</div>';
            }
        }

        function showMessage(message, type = 'success') {
            const messagesDiv = document.getElementById('messages');
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.textContent = message;
            messagesDiv.appendChild(messageEl);
            setTimeout(() => messageEl.remove(), 5000);
        }

        async function refreshData() {
            if (!isLoggedIn) return;
            
            try {
                document.body.classList.add('loading');
                
                // Use mock endpoint
                const response = await fetch('/api/admin/pending-mock', {
                    headers: {
                        'x-admin-token': 'simple-admin-token'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    updateStats(data.transactions);
                    renderTransactions(data.transactions);
                    document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleString();
                } else {
                    throw new Error(data.message || 'Failed to fetch data');
                }
            } catch (error) {
                console.error('Error:', error);
                showMessage('Error loading data: ' + error.message, 'error');
            } finally {
                document.body.classList.remove('loading');
            }
        }

        function updateStats(transactions) {
            const deposits = transactions.filter(t => t.type === 'deposit');
            const withdrawals = transactions.filter(t => t.type === 'withdrawal');
            
            document.getElementById('totalPending').textContent = transactions.length;
            document.getElementById('pendingDeposits').textContent = deposits.length;
            document.getElementById('pendingWithdrawals').textContent = withdrawals.length;
        }

        function renderTransactions(transactions) {
            const container = document.getElementById('transactionsList');
            
            if (transactions.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align: center; color: #666;">No pending transactions</div>';
                return;
            }

            container.innerHTML = transactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-info">
                        <div>
                            <span class="transaction-type type-${transaction.type}">${transaction.type}</span>
                        </div>
                        <div class="transaction-amount">$${transaction.amount}</div>
                        <div class="transaction-user">${transaction.user_email || transaction.email || 'Unknown'}</div>
                        <div class="transaction-date">${new Date(transaction.created_at).toLocaleString()}</div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-approve" onclick="processTransaction('${transaction.id}', 'approve', '${transaction.type}')">
                            Approve
                        </button>
                        <button class="btn btn-reject" onclick="processTransaction('${transaction.id}', 'reject', '${transaction.type}')">
                            Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        async function processTransaction(id, action, type) {
            if (!confirm(`Are you sure you want to ${action} this ${type}?`)) return;
            
            // Mock processing - just show success and remove from list
            showMessage(`${type} ${action}d successfully! (Mock mode)`, 'success');
            
            // Remove the transaction from the display
            setTimeout(() => {
                refreshData();
            }, 1000);
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            if (isLoggedIn) refreshData();
        }, 30000);
    </script>
</body>
</html>
