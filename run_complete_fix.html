<!DOCTYPE html>
<html>
<head>
    <title>Run Complete TIC Distribution Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background-color: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üöÄ Running Complete TIC Distribution Fix</h1>
    <div id="status" class="status info">Starting complete fix...</div>
    <div id="results"></div>

    <script>
        async function runCompleteFix() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                statusDiv.innerHTML = 'üîÑ Running complete fix (cleanup + immediate fix)...';
                statusDiv.className = 'status info';
                
                const response = await fetch('https://tic-global-r29posjkk-changs-projects-b6f8a2cc.vercel.app/api/run-complete-fix', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache'
                    }
                });
                
                const data = await response.json();
                
                resultsDiv.innerHTML = '<h3>Complete Fix Results:</h3><pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                if (data.success) {
                    statusDiv.innerHTML = `‚úÖ COMPLETE FIX SUCCESS: ${data.message}`;
                    statusDiv.className = 'status success';
                    
                    // Show summary
                    const summary = data.summary;
                    if (summary) {
                        resultsDiv.innerHTML += `
                            <h3>Summary:</h3>
                            <ul>
                                <li><strong>Step 1 (Cleanup):</strong> ${summary.step1_cleanup_success ? '‚úÖ Success' : '‚ùå Failed'}</li>
                                <li><strong>Step 2 (Immediate Fix):</strong> ${summary.step2_immediate_success ? '‚úÖ Success' : '‚ùå Failed'}</li>
                                <li><strong>Distributions Fixed:</strong> ${summary.distributions_fixed}</li>
                                <li><strong>Errors:</strong> ${summary.errors_count}</li>
                                <li><strong>Date:</strong> ${data.date}</li>
                            </ul>
                        `;
                    }
                    
                    // Add next steps
                    resultsDiv.innerHTML += `
                        <div class="status success">
                            <h3>‚úÖ Fix Complete! Next Steps:</h3>
                            <ol>
                                <li>Go to user dashboard: <a href="https://tic-global-r29posjkk-changs-projects-b6f8a2cc.vercel.app/my-accounts" target="_blank">My Accounts</a></li>
                                <li>Check TIC Token Distribution section</li>
                                <li>Verify distributions show today's date (${data.date})</li>
                                <li>Verify VIP users show 18.90 TIC (not 810 TIC)</li>
                                <li>Click "Refresh" button to update display</li>
                            </ol>
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `‚ùå COMPLETE FIX FAILED: ${data.message}`;
                    statusDiv.className = 'status error';
                }
                
            } catch (error) {
                statusDiv.innerHTML = `‚ùå ERROR: ${error.message}`;
                statusDiv.className = 'status error';
                resultsDiv.innerHTML = '<h3>Error Details:</h3><pre>' + error.stack + '</pre>';
            }
        }
        
        // Run complete fix immediately
        runCompleteFix();
    </script>
</body>
</html>
